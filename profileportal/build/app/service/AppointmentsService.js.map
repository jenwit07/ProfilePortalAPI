{"version":3,"file":"AppointmentsService.js","names":["_sequelize","require","_excluded","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","stausMap","getAppointmentService","_x","_getAppointmentService","_asyncToGenerator2","_regenerator","mark","_callee","query","cur_page","per_page","offset","limit","rest","result","wrap","_callee$","_context","prev","next","_objectWithoutProperties2","appointmentDb","appointments","findAndCountAll","where","status","Op","ne","order","sent","rows","map","item","abrupt","total_records","count","total_pages","Math","ceil","parseInt","curren_page","t0","stop","createAppointmentService","_x2","_createAppointmentService","_callee2","data","obj","_callee2$","_context2","update_by","create_by","create","getAppointmentByIdService","_x3","_getAppointmentByIdService","_callee3","id","_callee3$","_context3","findOne","Error","updateAppointmentService","_x4","_x5","_updateAppointmentService","_callee4","exist","history","_callee4$","_context4","update","dataValues","update_history","appointment_id","message","deleteAppointmentService","_x6","_deleteAppointmentService","_callee5","_callee5$","_context5"],"sources":["../../../src/app/service/AppointmentsService.js"],"sourcesContent":["\nimport { Op } from \"sequelize\";\n\nconst stausMap = {\n  \"TO_DO\": \"To Do\",\n  \"IN_PROGRESS\": \"In Progress\",\n  \"DONE\": \"Done\",\n  \"KEEP\": \"Keep\"\n}\n\nexport async function getAppointmentService ( query ) {\n  try {\n    const { cur_page, per_page, offset, limit, ...rest } = query;\n    const result = await appointmentDb.appointments.findAndCountAll({\n      offset: offset,\n      limit: limit,\n      where: {\n        status: { \n          [Op.ne]: 'KEEP'\n        },\n        ...rest,\n      },\n      order: [['create_datetime', 'ASC']]\n    } );\n    result.rows.map( item => {\n      item.status = stausMap[item.status] || item.status;\n      return item;\n    } )\n    \n    return {\n      appointments: result.rows,\n      total_records: result.count,\n      total_pages: Math.ceil(result.count / (per_page ? parseInt(per_page) : result.count)),\n      curren_page: cur_page ? parseInt(cur_page) : 1,\n      per_page: per_page ? parseInt(per_page) : result.count\n    };\n\n  } catch (e) {\n    throw e;\n  }\n}\n\nexport async function createAppointmentService(data) {\n  try {\n    if (!data.status) data.status = 'TO_DO';\n    if (!data.update_by) data.update_by = data.create_by;\n    const obj = await appointmentDb.appointments.create(data);\n    return obj;\n  } catch (e) {\n    throw e;\n  }\n}\n\nexport async function getAppointmentByIdService ( id ) {\n  try {\n    const result = await appointmentDb.appointments.findOne({\n      where: { id: id },\n    });\n    if (!result) {\n      throw new Error('Appointment not found');\n    }\n    return result;\n  } catch (e) {\n    throw e;\n  }\n}\n\nexport async function updateAppointmentService(id, data) {\n  try {\n    //check status\n    if ( !data.status ) throw new Error( 'Status is required' );\n    if ( !stausMap[data.status] ) throw new Error( 'Invalid status' );\n    const exist = await appointmentDb.appointments.findOne({\n      where: { id: id },\n    });\n    const result = await appointmentDb.appointments.update(data, {\n      where: { id: id },\n    } );\n    if (result[0] === 0) {\n      throw new Error('Appointment not found or no changes made');\n    } \n    delete exist.dataValues.id;\n    const history = await appointmentDb.update_history.create( {\n      appointment_id: id,\n      ...exist.dataValues\n    } );\n    return { message: 'Appointment updated successfully' };\n  \n  } catch (e) {\n    throw e;\n  }\n}\n\nexport async function deleteAppointmentService(id) {\n  try {\n    const result = await appointmentDb.appointments.update(\n      { status: 'KEEP' },\n      { where: { id: id } }\n    );\n    if (result === 0) {\n      throw new Error('Appointment not found');\n    } else {\n      return { message: 'Appointment deleted successfully' };\n    }\n  } catch (e) {\n    throw e;\n  }\n}\n"],"mappings":"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"}