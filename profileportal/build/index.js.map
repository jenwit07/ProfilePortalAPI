{"version":3,"file":"index.js","names":["_express","_interopRequireDefault","require","_bodyParser","_cors","_fs","_yaml","_swaggerUiExpress","_routes","_dayjs","_db","_initModels","_initModels2","_sequelize","OpenApiValidator","_interopRequireWildcard","_path","_helmet","_expressRateLimit","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","env","concat","process","NODE_ENV","bodyParser","port","LINEPORT","app","express","global","appointmentDb","initModels","sequelize","DataTypes","authDb","authInitModels","authSqualize","use","json","limit","extended","urlencoded","req","res","next","header","setHeader","cors","helmet","limiter","rateLimit","windowMs","LIMITER_WINDOWMS","max","LIMITER_MAX","message","LIMITER_MESSAGE","apiSpec","path","join","__dirname","file","fs","readFileSync","swaggerDocument","YAML","parse","swaggerUi","serve","setup","middleware","validateResponses","send","routes","err","status","errors","listen","console","log","dayjs","format","APP_ENV","module","exports"],"sources":["../src/index.js"],"sourcesContent":["require(\"custom-env\").env(`${process.env.NODE_ENV}`);\nimport express from \"express\";\nimport { json, urlencoded } from \"body-parser\";\nimport cors from \"cors\";\nimport fs from \"fs\";\nimport YAML from \"yaml\";\nimport swaggerUi from \"swagger-ui-express\";\nimport routes from \"./config/routes\";\nimport dayjs from \"dayjs\";\nimport { sequelize, authSqualize } from \"./config/db.config\";\nimport { initModels } from \"./app/models/init-models\";\nimport { initModels as authInitModels } from \"./app/auth/init-models\";\nimport { DataTypes } from \"sequelize\";\nimport * as OpenApiValidator from 'express-openapi-validator';\nimport path from \"path\";\nimport helmet from 'helmet';\nimport rateLimit from 'express-rate-limit';\n\n/* CONFIG */\nconst bodyParser = require(\"body-parser\");\nconst port = process.env.LINEPORT || 3306;\n\nvar app = express();\nglobal.appointmentDb = initModels( sequelize, DataTypes );\nglobal.authDb = authInitModels( authSqualize, DataTypes );\n\napp.use(json({ limit: \"50mb\", extended: true }));\napp.use(urlencoded({ limit: \"50mb\", extended: true }));\napp.use((req, res, next) => {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\"Access-Control-Allow-Methods\", \"GET,PUT,POST,DELETE,OPTIONS\");\n  res.header(\"Access-Control-Allow-Headers\", \"Content-Type\");\n  res.header(\"Access-Control-Expose-Headers\", \"ETag\");\n  res.setHeader(\"Access-Control-Allow-Credentials\", true);\n  next();\n});\napp.use(cors());\n\napp.use(bodyParser.json());\napp.use(\n  bodyParser.urlencoded({\n    extended: true,\n  })\n);\n\n\napp.use( helmet() );\n\n/* Limit requests from same API */\nconst limiter = rateLimit({\n  windowMs: process.env.LIMITER_WINDOWMS, // 1 hour\n  max: process.env.LIMITER_MAX,\n  message: process.env.LIMITER_MESSAGE\n});\napp.use(limiter);\n\n/ * Swagger Documentation and OpenAPI Specification * /\nconst apiSpec = path.join( __dirname ,'api.yaml' );\nconst file  = fs.readFileSync(apiSpec, 'utf8')\nconst swaggerDocument = YAML.parse(file)\napp.use('/profileportal/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument));\napp.use(\n  OpenApiValidator.middleware({\n    apiSpec,\n    validateResponses: false,\n  }),\n);\n\napp.get(\"/\", (req, res) => {\n  res.send(\n    `Profile Portal Service is running`\n  );\n});\n\nroutes( app );\n\napp.use((err, req, res, next) => {\n  // format error\n  res.status(err.status || 500).json({\n    message: err.message,\n    errors: err.errors,\n  });\n});\n\nif (process.env.NODE_ENV !== 'test') {\n  app.listen(port, () => {\n    console.log(\n      `#### Stat Time ${dayjs().format(\n        \"DD/MM/YYYY HH:mm:ss\"\n      )} --- Profile Portal Service is running on port ${port} and ${\n        process.env.APP_ENV\n      } env`\n    );\n  });\n}\n\nmodule.exports = app;\n"],"mappings":"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"}